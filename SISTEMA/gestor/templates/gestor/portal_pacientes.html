{% extends "base.html" %}

{% block content %}

<div class="max-w-3xl mx-auto mt-10 p-6 bg-white rounded shadow">

    {% if modo == "sin_autenticacion" %}
        <h1 class="text-2xl font-bold mb-4">Portal de Pacientes</h1>
        <p class="mb-4">Ingresa el RUT del paciente para ver sus citas.</p>

        <form method="POST">
            {% csrf_token %}
            <label class="block mb-2 font-semibold">RUT del Paciente</label>
            <input name="rut" class="border px-3 py-2 rounded w-full" required>
            <button class="mt-4 px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700">
                Consultar
            </button>
        </form>

    {% else %}

        <!-- T√≠tulo din√°mico -->
        <h1 class="text-2xl font-bold mb-6">
            Citas de:
            <span class="text-blue-700">
                {{ usuario_consultado.first_name }} {{ usuario_consultado.last_name }}
                ({{ usuario_consultado.rut }})
            </span>
        </h1>

        <!-- Resultado -->
        {% if citas %}
            <ul class="space-y-4">
                {% for c in citas %}
                

                <li class="p-4 border rounded shadow-sm bg-gray-50">
                    <div class="flex justify-between items-start mt-4">
    
    <!-- Informaci√≥n de la cita -->
    <div class="flex-1 pr-4">
        <p><strong>Fecha:</strong> {{ c.fecha_hora|date:"d-m-Y" }}</p>
        <p><strong>Hora:</strong> {{ c.fecha_hora|time:"H:i" }}</p>
        <p><strong>Doctor:</strong> {{ c.doctor.first_name }} {{ c.doctor.last_name }}</p>

        <p class="mt-2">
            <strong>Estado:</strong>
            <span
                class="
                    inline-flex items-center gap-1
                    px-3 py-1 text-sm font-semibold rounded-full
                    {% if c.estado == 'pendiente' %}
                        bg-yellow-100 text-yellow-800 border border-yellow-300
                    {% elif c.estado == 'confirmada' %}
                        bg-green-100 text-green-800 border border-green-300
                    {% elif c.estado == 'cancelada' %}
                        bg-red-100 text-red-800 border border-red-300
                    {% elif c.estado == 'completada' %}
                        bg-blue-100 text-blue-800 border border-blue-300
                    {% endif %}
                "
            >
                {% if c.estado == 'pendiente' %}
                    ‚è≥
                {% elif c.estado == 'confirmada' %}
                    ‚úîÔ∏è
                {% elif c.estado == 'cancelada' %}
                    ‚ùå
                {% elif c.estado == 'completada' %}
                    ü©∫
                {% endif %}
                {{ c.estado|title }}
            </span>
        </p>
    </div>

    <!-- Botones verticales -->
    <div class="flex flex-col space-y-2 text-right">
        <a href="{% url 'editar_cita' c.id_cita %}"
           class="px-3 py-2 bg-medical-primary text-white text-center rounded-lg text-sm hover:bg-medical-secondary transition">
            Editar
        </a>

        {% if c.estado != "cancelada" %}
        <a href="{% url 'cancelar_cita' c.id_cita %}"
           class="px-3 py-2 bg-yellow-500 text-white rounded-lg text-sm hover:bg-yellow-600 transition">
           Cancelar
        </a>
        {% endif %}

        <a href="{% url 'eliminar_cita' c.id_cita %}"
           class="px-3 py-2 bg-red-600 text-white rounded-lg text-sm hover:bg-red-700 transition">
           Eliminar
        </a>
    </div>

</div>

                </li>
                {% endfor %}
            </ul>
        {% else %}
            <p class="text-gray-600">No hay citas registradas.</p>
        {% endif %}

        <!-- Volver a consultar si no est√° logueado -->
        {% if modo == "consulta_rut" %}
            <a href="{% url 'portal_pacientes' %}"
               class="inline-block mt-6 px-4 py-2 rounded bg-gray-200 hover:bg-gray-300">
               Consultar otro RUT
            </a>
        {% endif %}

    {% endif %}

</div>

{% endblock %}
