{% extends "base.html" %}

{% load static %}

{% block title %}
Mis Datos Personales
{% endblock %}



{% block content %}


{% if user.is_authenticated %}
<div class="max-w-4xl mx-auto mt-10 bg-white p-8 rounded shadow">

    <h1 class="text-2xl font-bold mb-6">Mis datos personales: {{ user.first_name }} {{ user.last_name }}</h1>
    <a href="{% url 'editar_perfil' %}" class="text-blue-600 underline">
    Editar mis datos
    </a>


    <!-- ================== DATOS BÁSICOS ================== -->
    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">

        <div>
            <h2 class="text-lg font-semibold">Información Personal</h2>
            <ul class="mt-2 text-gray-700">
                <li><strong>RUT:</strong> {{ user.rut }}</li>
                <li><strong>Nombre:</strong> {{ user.first_name }} {{ user.last_name }}</li>
                <li><strong>Email:</strong> {{ user.email }}</li>
                <li><strong>Teléfono:</strong> {{ user.telefono }}</li>
                <li><strong>Dirección:</strong> {{ user.direccion }}</li>
                <li><strong>Fecha de nacimiento:</strong> {{ user.fecha_nac }}</li>
            </ul>
        </div>

        <!-- ================== INFO MÉDICA ================== -->
        <div>
            <h2 class="text-lg font-semibold">Información Médica</h2>

           <h3 class="mt-3 font-medium text-gray-800">Enfermedades</h3>
            {% if user.enfermedades.exists %}
                <ul class="text-gray-700">
                    {% for enf in user.enfermedades.all %}
                        <li>- {{ enf.nombre }}</li>
                    {% endfor %}
                </ul>
            {% else %}
                <p class="text-gray-600">No registra enfermedades.</p>
            {% endif %}

            <h3 class="mt-3 font-medium text-gray-800">Discapacidades</h3>
            {% if user.discapacidades.exists %}
                <ul class="text-gray-700">
                    {% for dis in user.discapacidades.all %}
                        <li>- {{ dis.nombre }}</li>
                    {% endfor %}
                </ul>
            {% else %}
                <p class="text-gray-600">No registra discapacidades.</p>
            {% endif %}

        </div>

    </div>

    <!-- ================== RECETAS MÉDICAS ================== -->
    <div class="mt-10">
        <h2 class="text-xl font-semibold mb-4">Recetas Médicas</h2>

        {% if recetas %}
            <div class="space-y-4">
                {% for receta in recetas %}
                <div class="border p-4 rounded shadow-sm bg-gray-50">
                    <p><strong>Médico:</strong> {{ receta.doctor.first_name }} {{ receta.doctor.last_name }}</p>
                    <p><strong>Fecha emisión:</strong> {{ receta.fecha_emision }}</p>
                    <p><strong>Medicamento:</strong> {{ receta.medicamento }}</p>

                    {% if receta.indicaciones %}
                    <p><strong>Indicaciones:</strong> {{ receta.indicaciones }}</p>
                    {% endif %}

                    {% if receta.duracion_tratamiento %}
                    <p><strong>Duración del tratamiento:</strong> {{ receta.duracion_tratamiento }} días</p>
                    {% endif %}
                </div>
                {% endfor %}
            </div>

        {% else %}
            <p class="text-gray-600">No registra recetas prescritas.</p>
        {% endif %}
    </div>

</div>

{% endif %}

{% endblock %}